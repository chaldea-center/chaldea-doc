# Laplace 开发笔记

又名《螺旋社之十万个为什么》

[[toc]]

## 大总统指令卡的目标切换

宝具卡、全体攻击卡(大总统 Buster / Extra)前后均会触发敌方的退场/亡语。
举例说明：大总统BAQ接EX会执行三次退场结算:

1. Buster后执行第一次退场
2. AQ之后执行第二次退场
3. EX之后执行第三次退场

## DOT伤害结算

回合结束时，先记录当前血量(`hp`)为`currentHp`，接着先结算回血，再结算扣血。若扣血会导致从者退场(`hp <= 0`):

- 当敌方(包括候补)存在幸存者: 正常结算，即`damage = hp - DotDamage`
- 当敌方(包括候补)全部死亡时: 让该从者存活，DoT伤害变为`currentHp - 1`

举例说明，巴贝奇装备1HP的毅力礼装后使用3技能(300 DoT)，梵高使用二技能(100 Dot + 300 HoT)，接着陈宫嘲讽自己发射巴贝奇：

- 若当前敌方(包括候补)存在幸存者: 巴贝奇血量为 `1 + 300 - 400 < 0` 结算阵亡退场
- 若当敌方(包括候补)全部死亡时: 巴贝奇血量为 `1 + 300 - 0 = 301`，此时由于当前血量为1，所以DoT伤害为 `1 - 1 = 0`

也就是说，击杀当前wave的全部敌人可以帮助有致死DoT的从者多活一回合。

## 鞭尸 Bug Bug

众所周知，fgo的普通指令卡有鞭尸bug，导致即使游戏内未显示Overkill时也算作Overkill。

该bug作为良性bug被当作feature保留了下来，如果出卡之间敌方结算了退场并且发动亡语或者毅力时发动的buff，则鞭尸bug失效。

该鞭尸bug bug可以在2.6的新达灵顿free第二面测试，这面包含一个没有亡语的大怪和两个有亡语的小怪。使用AOE宝具击杀两个小怪同时把大怪打到半血以下可以发现鞭尸bug此时失效。

## 复数改变职阶相性的叠加

举例莱妮斯放宝具打消防御不利相性，迦摩使用三技能变为对AE阶有利，同时AE阶敌方单位赋予自身对杀阶攻击有利，最终该AE阶敌方攻击迦摩会是几倍克制？

该问题的答案取决于迦摩三技能和莱妮斯宝具的顺序:

- 首先，防御方的buff会覆盖掉攻击方的，所以直接忽视AE攻击者的buff
- 迦摩身上此时有复数的职阶相性buff，**先上的buff覆盖后上的buff**，即先放莱妮斯宝具，则最终克制系数为1; 反之先放迦摩三技能，则为0.5

~~很神奇吧~~

## 复数宝具色卡变更buff的叠加

可以自己带俩光兔兔和仇凛 + CD服试试看！答案是后选的卡色会覆盖先选的卡色。

## 复仇/Revenge的目标选择

自身受到伤害类型分为: 指令卡伤害、宝具伤害、HP减少(lossHp)、DoT(毒/诅咒/灼烧)、damageValue(多见于敌方直接造成伤害)。

在计算“最后一个对自身造成伤害的单位”时，均不计入自身造成伤害，其中DoT类伤害来源固定为自身。

1. funcTargetType=enemyOneNoDamageNoAction

   最后一个攻击自身的己方或敌方单位，若无，则不发动该效果。例：五百年的执着。

2. Buffs: selfturnendFunction(每回合结束发动), delayFunction(X回合后发动), gutsFunction(毅力时发动),
   damageFunction(受击时发动), deadFunction(死亡时发动)

   Trigger技能的默认目标为最后一个攻击自身的敌方单位，如enemyOne。若无攻击自身的记录，则随机选择一个敌方或己方单体。Laplace则回退到界面中选择的单位。
